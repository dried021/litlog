<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bookfox.repository.CollectionMapper">
    <select id="selectPopularCollectionsThisWeek" resultType="com.bookfox.model.CollectionDto">
        SELECT c.id, c.title, c.user_id, c.creation_date, c.content, c.thumbnail
        FROM book_collection c
        LEFT JOIN book_collection_like l ON c.id = l.collection_id
        WHERE YEARWEEK(c.creation_date, 1) = YEARWEEK(NOW(), 1)
        GROUP BY c.id
        ORDER BY COUNT(l.id) DESC
        LIMIT 10
    </select>

    <select id="selectAllCollectionsSortedByLikes" resultType="com.bookfox.model.CollectionDto">
        SELECT c.id, c.title, c.user_id, c.creation_date, c.content, c.thumbnail
        FROM book_collection c
        LEFT JOIN book_collection_like l ON c.id = l.collection_id
        GROUP BY c.id
        ORDER BY COUNT(l.id) DESC
    </select>

    <select id="selectAllCollectionsSortedByRecent" resultType="com.bookfox.model.CollectionDto">
        SELECT c.id, c.title, c.user_id, c.creation_date, c.content, c.thumbnail
        FROM book_collection c
        ORDER BY c.creation_date DESC
    </select>


</mapper>
